#!/usr/bin/env bash
# Run builds on modified tools to catch TypeScript/Python errors
# NOTE: Disabled auto-run of symlinks tests (they take 26+ seconds)
# Run manually with: cd tools/symlinks && uv run pytest

# Extensive error handling - NEVER block Claude Code
set +e  # Don't exit on error
exec 2>&1  # Redirect stderr to stdout for better logging

# Log initial state
echo "ðŸ” [stop-build-check] Starting from: $(pwd)" >&2

# Get repository root
if ! REPO_ROOT=$(git rev-parse --show-toplevel 2>&1); then
    echo "âš ï¸  [stop-build-check] ERROR: Not in a git repository" >&2
    echo "   Working directory: $(pwd)" >&2
    echo "   Git error: $REPO_ROOT" >&2
    exit 0  # Non-blocking
fi

echo "ðŸ” [stop-build-check] Repo root: $REPO_ROOT" >&2

# Change to repo root
if ! cd "$REPO_ROOT" 2>&1; then
    echo "âš ï¸  [stop-build-check] ERROR: Cannot cd to $REPO_ROOT" >&2
    exit 0  # Non-blocking
fi

echo "âœ… [stop-build-check] Successfully changed to repo root" >&2

# Symlinks tests disabled - run manually when needed
# if git diff --name-only HEAD | grep -q "tools/symlinks"; then
#     echo "ðŸ”¨ Running pytest for tools/symlinks..."
#     cd tools/symlinks
#     uv run pytest -q
# fi

exit 0
