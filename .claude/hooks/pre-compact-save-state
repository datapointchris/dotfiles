#!/usr/bin/env python3
"""
Saves session state before compaction.
Creates a session summary with key context to restore after compact.
"""
import json
import sys
from datetime import datetime
from pathlib import Path


def main():
    hook_input = json.loads(sys.stdin.read())

    # Create session archive
    session_dir = Path(".claude/sessions")
    session_dir.mkdir(exist_ok=True)

    timestamp = datetime.now().strftime("%Y-%m-%d-%H%M%S")
    session_file = session_dir / f"session-{timestamp}.json"

    # Save session metadata
    with open(session_file, "w") as f:
        json.dump(
            {
                "timestamp": timestamp,
                "cwd": hook_input["cwd"],
                "session_id": hook_input["session_id"],
                "transcript_path": hook_input.get("transcript_path"),
            },
            f,
            indent=2,
        )

    print(f"ðŸ’¾ Session state saved to {session_file}")


if __name__ == "__main__":
    main()
