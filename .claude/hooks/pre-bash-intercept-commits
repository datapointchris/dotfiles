#!/usr/bin/env python3
"""
Intercepts git commit commands and routes them to commit agent.
Uses exit code 2 to block execution per Claude Code hook specification.
"""
import json
import sys

try:
    data = json.load(sys.stdin)
    command = data.get('tool_input', {}).get('command', '')

    # Check if this is a git commit command
    if 'git commit' in command:
        # Exit code 2 blocks the tool execution
        # stderr becomes the feedback message to Claude
        print("⚠️ Direct git commits are not allowed. Use commit agent instead.", file=sys.stderr)
        print("", file=sys.stderr)
        print("Please invoke the Task tool with prompt:", file=sys.stderr)
        print("'Create commits for this work. Context: [brief description of what was done]'", file=sys.stderr)
        sys.exit(2)

    # Not a commit command - allow it
    sys.exit(0)

except Exception as e:
    # On error, allow the command (fail open)
    print(f"Hook error: {e}", file=sys.stderr)
    sys.exit(0)
