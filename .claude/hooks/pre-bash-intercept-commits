#!/usr/bin/env bash
# Intercepts git commit commands and routes them to commit agent

set -euo pipefail

# Read hook input (contains tool parameters)
HOOK_INPUT=$(cat)

# Extract the bash command from the JSON
COMMAND=$(echo "$HOOK_INPUT" | python3 -c "
import json, sys
data = json.load(sys.stdin)
params = data.get('tool_params', {})
print(params.get('command', ''))
")

# Check if this is a git commit command
if [[ "$COMMAND" == *"git commit"* ]]; then
    echo "ðŸš« Direct git commit blocked - routing to commit agent" >&2

    # Block the command and suggest using commit agent
    cat <<EOF
{
  "block": true,
  "message": "âš ï¸ Direct git commits are not allowed. Use commit agent instead.\\n\\nPlease invoke: Task tool with prompt 'Create commits for the staged changes'"
}
EOF
    exit 1
fi

# Not a commit - allow the command
exit 0
