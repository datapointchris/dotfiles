#!/usr/bin/env bash
set -euo pipefail

XDG_DATA_HOME="${XDG_DATA_HOME:-$HOME/.local/share}"
DATA_DIR="$XDG_DATA_HOME/patterns"
DATA_FILE="$DATA_DIR/entries.jsonl"

if [[ $# -eq 0 ]]; then
    echo "Usage: patterns <message>" >&2
    exit 1
fi

mkdir -p "$DATA_DIR"

MESSAGE="$*"
TIMESTAMP=$(date +"%Y-%m-%dT%H:%M:%S%z")

if ! command -v jq &> /dev/null; then
    echo "Error: jq is required but not installed" >&2
    exit 1
fi

ENTRY=$(jq -n \
    --arg timestamp "$TIMESTAMP" \
    --arg message "$MESSAGE" \
    '{timestamp: $timestamp, message: $message}')

echo "$ENTRY" >> "$DATA_FILE"
