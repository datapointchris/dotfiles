#!/usr/bin/env bash
# ================================================================
# menu - Workflow Tools Quick Reference
# ================================================================
# Simple launcher showing available workflow tools and commands
# Note: This is for development/workflow tools, NOT dotfiles management
# For dotfiles: use task symlinks:*, task install:*, etc.
# ================================================================

set -euo pipefail

# Color output helpers
color_green() { echo -e "\033[32m$1\033[0m"; }
color_blue() { echo -e "\033[34m$1\033[0m"; }
color_yellow() { echo -e "\033[33m$1\033[0m"; }
color_cyan() { echo -e "\033[36m$1\033[0m"; }

# ================================================================
# FUNCTIONS
# ================================================================

show_help() {
  gum style \
    --border=rounded \
    --border-foreground=4 \
    --padding="1 2" \
    --bold \
    "Workflow Tools - Quick Reference"

  echo ""
  color_yellow "Workflow Tools:"
  echo "  $(color_cyan "sess")             - Manage tmux sessions"
  echo "  $(color_cyan "tools [cmd]")      - Discover and learn about installed tools"
  echo "  $(color_cyan "theme-sync [cmd]") - Manage color themes across applications"
  echo "  $(color_cyan "nb [cmd]")         - Note taking and knowledge management"
  echo ""
  color_yellow "Quick Workflows:"
  echo "  $(color_cyan "tools list | fzf --preview='tools show {1}'")  - Explore tools interactively"
  echo "  $(color_cyan "theme-sync favorites | fzf")                    - Pick a theme"
  echo "  $(color_cyan "nb browse --gui")                               - Visual note browsing"
  echo ""
  color_yellow "Dotfiles Management:"
  echo "  $(color_cyan "task symlinks:link")     - Deploy dotfiles to home directory"
  echo "  $(color_cyan "task symlinks:check")    - Verify symlinks are correct"
  echo "  $(color_cyan "task --list-all")        - Show all available tasks"
  echo ""
  color_yellow "Documentation:"
  echo "  $(color_cyan "http://localhost:8000")  - MkDocs documentation site"
  echo "  $(color_cyan "$HOME/dotfiles/CLAUDE.md")   - Development context and guidelines"
  echo ""

  gum style --faint "Run 'menu launch' for interactive launcher"
}

launch_menu() {
  # Show header
  gum style \
    --border=rounded \
    --border-foreground=4 \
    --padding="1 2" \
    --bold \
    "Workflow Tools - What do you want to do?"

  echo ""

  # Get choice
  choice=$(gum choose \
    "Switch tmux session" \
    "Find a tool" \
    "Change theme" \
    "Take/find a note" \
    "Browse documentation" \
    "Manage symlinks" \
    "View this help")

  case "$choice" in
    "Switch tmux session")
      sess ;;

    "Find a tool")
      # Check if fzf is available
      if command -v fzf &>/dev/null; then
        tools list | fzf \
          --preview="tools show {1}" \
          --preview-window=right:60%:wrap \
          --header="Tools - Press Enter to see full details"
      else
        # Fallback to simple list
        tools list
        echo ""
        echo "Tip: Install fzf for interactive tool exploration"
      fi
      ;;

    "Change theme")
      if command -v fzf &>/dev/null; then
        selected=$(theme-sync favorites | fzf \
          --header="Select a theme to apply")
        if [[ -n "$selected" ]]; then
          theme-sync apply "$selected"
        fi
      else
        theme-sync favorites
        echo ""
        echo "Tip: Install fzf for interactive theme selection"
      fi
      ;;

    "Take/find a note")
      # Check if nb is installed
      if command -v nb &>/dev/null; then
        nb
      else
        color_yellow "nb is not installed."
        echo "Install with: brew install nb"
      fi
      ;;

    "Browse documentation")
      color_green "Opening documentation..."
      echo ""
      echo "MkDocs site: http://localhost:8000"
      echo "Start server with: task docs:serve"
      echo ""
      echo "Or view files directly:"
      echo "  CLAUDE.md - Development context"
      echo "  README.md - Project overview"
      echo "  docs/ - Full documentation"
      ;;

    "Manage symlinks")
      color_green "Symlink Management Commands:"
      echo ""
      echo "  task symlinks:link   - Deploy dotfiles to home directory"
      echo "  task symlinks:check  - Verify symlinks are correct"
      echo "  task symlinks:show   - Show symlink mappings"
      echo ""
      read -r -p "Press Enter to continue..."
      ;;

    "View this help")
      show_help ;;
  esac
}

# ================================================================
# MAIN
# ================================================================

case "${1:-help}" in
  help|--help|-h)
    show_help
    ;;

  launch|menu|l|m)
    launch_menu
    ;;

  version|--version|-v)
    echo "menu v1.0.0"
    echo "Workflow tools quick reference launcher"
    ;;

  *)
    color_yellow "Unknown command: $1"
    echo ""
    echo "Usage:"
    echo "  menu              - Show help"
    echo "  menu launch       - Interactive launcher"
    echo "  menu help         - Show this help"
    echo ""
    exit 1
    ;;
esac
