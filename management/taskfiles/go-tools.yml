# ================================================================
# Go Tools Tasks
# ================================================================
# Manages Go tools installation via go install
# Packages defined in management/packages.yml
#
# For simple go commands, use go directly:
#   go install <package>@latest   # Install a tool
#   go version                     # Check Go version
#   go env GOPATH                  # Check Go path

version: '3'

vars:
  PACKAGES_CONFIG: "{{.ROOT_DIR}}/management/packages.yml"
  GOBIN: "{{.HOME}}/go/bin"

tasks:
  # ================================================================
  # INSTALLATION
  # ================================================================

  install:
    desc: Install all Go tools from packages.yml
    silent: true
    deps:
      - check-go
      - check-config
    cmds:
      - echo "✅ Installing Go tools..."
      - |
        # Get go tools from packages.yml via Python parser
        /usr/bin/python3 {{.ROOT_DIR}}/management/parse-packages.py --type=go | while read -r tool; do
          echo "  Installing $tool..."
          go install "$tool@latest"
        done
      - echo "✅ Go tools installed to {{.GOBIN}}!"

  # ================================================================
  # UPDATE
  # ================================================================

  update:
    desc: Update all Go tools
    silent: true
    cmds:
      - echo "  Updating Go tools..."
      - |
        # Reinstall all tools to get latest versions
        /usr/bin/python3 {{.ROOT_DIR}}/management/parse-packages.py --type=go | while read -r tool; do
          echo "  Updating $tool..."
          go install "$tool@latest"
        done
      - echo "  Go tools updated"

  # ================================================================
  # HELPERS
  # ================================================================

  check-go:
    desc: Check if Go is installed
    internal: true
    preconditions:
      - sh: command -v go >/dev/null 2>&1
        msg: |
          Go is not installed. It will be installed via install-go.sh script.

  check-config:
    desc: Check packages.yml exists
    internal: true
    preconditions:
      - sh: test -f {{.PACKAGES_CONFIG}}
        msg: "packages.yml not found at {{.PACKAGES_CONFIG}}"
