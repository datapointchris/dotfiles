# ================================================================
# macOS-Specific Tasks
# ================================================================
# Platform-specific installation and configuration for macOS
# Assumes Intel Mac with Homebrew at /usr/local

version: '3'

vars:
  HOMEBREW_PREFIX: "/usr/local"

tasks:
  # ================================================================
  # PREREQUISITES
  # ================================================================

  install-homebrew:
    desc: Install Homebrew (if not present)
    silent: true
    cmds:
      - |
        if command -v brew >/dev/null 2>&1; then
          echo "✅ Homebrew already installed"
        else
          echo "✅ Installing Homebrew..."
          /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
          echo "✅ Homebrew installed"
        fi
    status:
      - command -v brew >/dev/null 2>&1

  # ================================================================
  # XCODE & COMMAND LINE TOOLS
  # ================================================================

  install-xcode-tools:
    desc: Install Xcode Command Line Tools
    silent: true
    cmds:
      - |
        if xcode-select -p &>/dev/null; then
          echo "✅ Xcode Command Line Tools already installed"
        else
          echo "✅ Installing Xcode Command Line Tools..."
          xcode-select --install
          echo "Complete the installation in the GUI prompt"
          echo "Run 'task macos:install-xcode-tools' again after installation completes"
        fi

  # ================================================================
  # MACOS CONFIGURATION
  # ================================================================

  configure:
    desc: Apply macOS system preferences
    silent: true
    cmds:
      - echo "✅ Configuring macOS system preferences..."
      - task: configure-finder
      - task: configure-dock
      - task: configure-keyboard
      - echo "✅ macOS configured!"
      - echo "Some changes may require logout/restart"

  configure-finder:
    desc: Configure Finder preferences
    internal: true
    silent: true
    cmds:
      - |
        echo "  Configuring Finder..."
        # Show hidden files
        defaults write com.apple.finder AppleShowAllFiles -bool true
        # Show file extensions
        defaults write NSGlobalDomain AppleShowAllExtensions -bool true
        # Show path bar
        defaults write com.apple.finder ShowPathbar -bool true
        # Show status bar
        defaults write com.apple.finder ShowStatusBar -bool true
        # Restart Finder
        killall Finder
        echo " Finder configured"

  configure-dock:
    desc: Configure Dock preferences
    internal: true
    silent: true
    cmds:
      - |
        echo "  Configuring Dock..."
        # Auto-hide dock
        defaults write com.apple.dock autohide -bool true
        # Restart Dock
        killall Dock
        echo " Dock configured"

  configure-keyboard:
    desc: Configure keyboard preferences
    internal: true
    silent: true
    cmds:
      - |
        echo "  Configuring keyboard..."
        # Fast key repeat
        defaults write NSGlobalDomain KeyRepeat -int 2
        defaults write NSGlobalDomain InitialKeyRepeat -int 15
        echo " Keyboard configured"

  # ================================================================
  # UTILITIES
  # ================================================================
  # For system maintenance, use native commands directly:
  #   softwareupdate --list                # Check for system updates
  #   softwareupdate --install --all       # Install system updates
  #   brew cleanup                         # Clean Homebrew caches
  #   brew doctor                          # Run Homebrew diagnostics
  #   sw_vers                              # Show macOS version
