# ================================================================
# UV (Python Package Manager) Tasks
# ================================================================
# Manages Python tools installation via uv
# Packages defined in config/packages.yml
#
# For simple uv commands, use uv directly:
#   uv tool list                # List installed tools
#   uv tool install <tool>      # Install a tool
#   uv tool uninstall <tool>    # Remove a tool
#   uv tool upgrade <tool>      # Upgrade specific tool
#   uv tool upgrade --all       # Upgrade all tools
#   uv self update              # Update uv itself
#   uv cache clean              # Clean cache
#   uv python list              # List Python versions
#   uv python install <version> # Install Python version

version: '3'

vars:
  PACKAGES_CONFIG: "{{.ROOT_DIR}}/config/packages.yml"

tasks:
  # ================================================================
  # INSTALLATION
  # ================================================================

  install:
    desc: Install all uv tools
    silent: true
    deps:
      - check-uv
      - check-config
    cmds:
      - echo "✅ Installing Python tools via uv..."
      - uv tool install ruff
      - uv tool install mypy
      - uv tool install basedpyright
      - uv tool install codespell
      - uv tool install sqlfluff
      - uv tool install mdformat
      - uv tool install djlint
      - uv tool install keymap-drawer
      - uv tool install nbpreview
      - uv tool install numpy
      - echo "✅ Python tools installed!"

  # ================================================================
  # UPDATE
  # ================================================================

  update:
    desc: Update all uv tools
    internal: true
    silent: true
    cmds:
      - echo "  Updating Python tools via uv..."
      - uv tool upgrade --all
      - echo "  Python tools updated"

  # ================================================================
  # HELPERS
  # ================================================================

  check-uv:
    desc: Check if uv is installed
    internal: true
    preconditions:
      - sh: command -v uv >/dev/null 2>&1
        msg: |
          uv is not installed. Install it with:
            macOS: brew install --cask uv
            Linux: curl -LsSf https://astral.sh/uv/install.sh | sh

  check-config:
    desc: Check packages.yml exists
    internal: true
    preconditions:
      - sh: test -f {{.PACKAGES_CONFIG}}
        msg: "packages.yml not found at {{.PACKAGES_CONFIG}}"
